<!DOCTYPE html>
<html class="writer-html5" lang="fr" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>1. R4.DevCloud.09 Fondamentaux de la conteneurisation &mdash; Documentation BUT2-DevCloud.Fondamentaux-de-la-conteneurisation </title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/translations.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Recherche" href="search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> BUT2-DevCloud.Fondamentaux-de-la-conteneurisation
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Rechercher docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <!-- Local TOC -->
              <div class="local-toc"><ul>
<li><a class="reference internal" href="#">1. R4.DevCloud.09 Fondamentaux de la conteneurisation</a><ul>
<li><a class="reference internal" href="#rappel-virtualisation">1.1 Rappel Virtualisation</a></li>
<li><a class="reference internal" href="#containers">1.2 Containers</a></li>
</ul>
</li>
<li><a class="reference internal" href="#docker-creation-et-deploiement-des-containers">2. Docker : Création et Déploiement des Containers</a><ul>
<li><a class="reference internal" href="#historique">2.1 Historique</a></li>
<li><a class="reference internal" href="#un-peu-de-theorie">2.2 Un peu de théorie</a></li>
<li><a class="reference internal" href="#architecture-docker">2.3 Architecture Docker</a><ul>
<li><a class="reference internal" href="#container">2.3.1 Container</a></li>
<li><a class="reference internal" href="#image">2.3.2 Image</a></li>
<li><a class="reference internal" href="#volume">2.3.3 Volume</a></li>
<li><a class="reference internal" href="#docker-daemon-docker-engine">2.3.4 Docker Daemon (Docker Engine)</a></li>
<li><a class="reference internal" href="#docker-client-docker-engine">2.3.5 Docker Client (Docker Engine)</a></li>
<li><a class="reference internal" href="#dockerfile">2.3.6 Dockerfile</a></li>
<li><a class="reference internal" href="#docker-compose">2.3.7 Docker Compose</a></li>
<li><a class="reference internal" href="#docker-desktop-pas-utilise-a-l-iut">2.3.8 Docker Desktop (pas utilisé à l’IUT)</a></li>
<li><a class="reference internal" href="#docker-registries">2.3.9 Docker Registries</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id1">2.4 Containers</a><ul>
<li><a class="reference internal" href="#exemple-de-commande-docker-run">2.4.1 Exemple de commande <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">run</span></code></a></li>
<li><a class="reference internal" href="#quelques-commandes-pour-les-conteneurs">2.4.2 Quelques commandes pour les conteneurs</a></li>
<li><a class="reference internal" href="#docker-run-en-detail">2.4.3 <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">run</span></code> en détail</a></li>
<li><a class="reference internal" href="#container-deux-grands-principes-a-comprendre">Container: deux grands principes à comprendre</a></li>
</ul>
</li>
<li><a class="reference internal" href="#persistance-des-donnees">Persistance des données</a><ul>
<li><a class="reference internal" href="#commit-docker-commit-container-image">Commit : <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">commit</span> <span class="pre">&lt;Container&gt;</span> <span class="pre">&lt;Image&gt;</span></code></a></li>
<li><a class="reference internal" href="#volumes">Volumes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#images">Images</a></li>
<li><a class="reference internal" href="#docker-et-la-gestion-du-reseau">Docker et la gestion du réseau</a><ul>
<li><a class="reference internal" href="#mode-bridge">Mode Bridge</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">BUT2-DevCloud.Fondamentaux-de-la-conteneurisation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>1. R4.DevCloud.09 Fondamentaux de la conteneurisation</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/aide.md.txt" rel="nofollow"> Afficher la source de la page</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="r4-devcloud-09-fondamentaux-de-la-conteneurisation">
<h1>1. R4.DevCloud.09 Fondamentaux de la conteneurisation<a class="headerlink" href="#r4-devcloud-09-fondamentaux-de-la-conteneurisation" title="Lien permanent vers cette rubrique"></a></h1>
<p><strong>Contexte et ancrage professionnel</strong></p>
<p>La conteneurisation des services et des applications est l’un des outils majeurs du Cloud.</p>
<p>Elle offre une grande flexibilité dans la conception et la maintenance des infrastructures.</p>
<p>Elle facilite également la portabilité et la gestion du cycle de vie des services et des applications.</p>
<section id="rappel-virtualisation">
<h2>1.1 Rappel Virtualisation<a class="headerlink" href="#rappel-virtualisation" title="Lien permanent vers cette rubrique"></a></h2>
<p>Un Hyperviseur (Promox, VMware, ..) simule une ou plusieurs machines physiques. Ces machines virtuelles (VM) embarquent leur propres système d’exploitation (OS Invité)</p>
<p><img alt="Virtualisation" src="_images/virtualisation.PNG" /></p>
<p><strong>MACHINES VIRTUELLES :</strong></p>
<ul class="simple">
<li><p>Emulation d’un ordinateur complet</p></li>
<li><p>Un Hyperviseur permet de « simuler » plusieurs ordinateurs sur une seule machine physique</p></li>
</ul>
<p><strong>Chaque VM :</strong></p>
<ul class="simple">
<li><p>Possède son propre système d’exploitation</p></li>
<li><p>Contient l’ensemble de services et applications à déployer</p></li>
</ul>
<p><strong>AVANTAGES :</strong></p>
<ul class="simple">
<li><p>Intéressant pour remplacer un nombre important de serveurs</p></li>
<li><p>Système complétement isolé et indépendants les uns des autres.</p></li>
<li><p>On peut avoir à la fois des VM sous Linux ou sous Windows</p></li>
</ul>
<p><strong>INCONVENIENTS :</strong></p>
<ul class="simple">
<li><p>Très gourmand en ressources processeur et mémoire même pour des petites applications</p></li>
<li><p>Des images lourdes à sauvegarder et à déployer (&gt; 10 Go)</p></li>
<li><p>Délais de démarrage de plusieurs minutes</p></li>
</ul>
</section>
<section id="containers">
<h2>1.2 Containers<a class="headerlink" href="#containers" title="Lien permanent vers cette rubrique"></a></h2>
<p>Les containers font eux appels à l’OS de la machine hôte et embarquent essentiellement les services et les applications à déployer</p>
<p><img alt="Containers" src="_images/conteneurisation.PNG" /></p>
<p><strong>CONTAINERS :</strong></p>
<ul class="simple">
<li><p>Pas de “simulation” du matériel</p></li>
<li><p>On ne virtualise que l’OS qui est dépendant du noyau de la machine hôte</p></li>
</ul>
<p><strong>Chaque Container :</strong></p>
<ul class="simple">
<li><p>Ne contient que le minimum de services nécéssaires</p></li>
<li><p>Partage le noyau de l’OS hôte avec les autres</p></li>
</ul>
<p><strong>AVANTAGES :</strong></p>
<ul class="simple">
<li><p>Très petites images (&lt; 1Go) - Facile à déployer et à sauvegarder</p></li>
<li><p>Délais de démarrage de quelques secondes</p></li>
<li><p>Consomme peu de ressources mémoires</p></li>
</ul>
<p><strong>INCONVENIENT:</strong></p>
<ul class="simple">
<li><p>Pas de diversification des OS (Essentiellement Linux)</p></li>
<li><p>Le partage d’un même OS hôte peut poser des problèmes de sécurité</p></li>
<li><p>La persistance des données doit être gérée hors container</p></li>
</ul>
</section>
</section>
<section id="docker-creation-et-deploiement-des-containers">
<h1>2. Docker : Création et Déploiement des Containers<a class="headerlink" href="#docker-creation-et-deploiement-des-containers" title="Lien permanent vers cette rubrique"></a></h1>
<ul class="simple">
<li><p>Docker est une plate-forme ouverte pour le développement, la livraison et l’exécution d’applications.</p></li>
<li><p>Docker vous permet de séparer vos applications de votre infrastructure afin de livrer le logiciel rapidement.</p></li>
<li><p>Avec Docker, vous pouvez gérer votre infrastructure de la même manière que vous gérez vos applications.</p></li>
<li><p>Docker offre la possibilité de conditionner et d’exécuter une application dans un environnement vaguement isolé appelé conteneur.</p></li>
<li><p>L’isolation et la sécurité vous permettent d’exécuter plusieurs conteneurs simultanément sur un hôte donné.</p></li>
<li><p>Les conteneurs sont légers et contiennent tout le nécessaire pour exécuter l’application, vous n’avez donc pas besoin de vous fier à ce qui est actuellement installé sur l’hôte.</p></li>
<li><p>Vous pouvez facilement partager des conteneurs pendant que vous travaillez et vous assurer que toutes les personnes avec lesquelles vous partagez reçoivent le même conteneur qui fonctionne de la même manière.</p></li>
</ul>
<section id="historique">
<h2>2.1 Historique<a class="headerlink" href="#historique" title="Lien permanent vers cette rubrique"></a></h2>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="text-left head"><p></p></th>
<th class="text-left head"><p></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p>2008</p></td>
<td class="text-left"><p>Solomon Hykes développe <code class="docutils literal notranslate"><span class="pre">Docker</span></code> pour un projet interne de <code class="docutils literal notranslate"><span class="pre">dotCloud</span></code>, une entreprise française qui propose une plate-forme de déploiement de services sur le Cloud (<code class="docutils literal notranslate"><span class="pre">Paas</span></code>)</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>2010</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">DotCloud</span></code> déménage en Californie et devient Docker Enterprise</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>2013</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">Docker</span></code> est distribué en tant que projet Open Source</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>2014</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">Docker</span></code> créé le <code class="docutils literal notranslate"><span class="pre">Docker-Hub</span></code></p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>2019</p></td>
<td class="text-left"><p>Le produit <code class="docutils literal notranslate"><span class="pre">Docker</span> <span class="pre">Enterprise</span></code> est revendue à Mirantis et effectue une levée de fonds de près de 35 Millions de dollars</p></td>
</tr>
</tbody>
</table>
</section>
<section id="un-peu-de-theorie">
<h2>2.2 Un peu de théorie<a class="headerlink" href="#un-peu-de-theorie" title="Lien permanent vers cette rubrique"></a></h2>
<p>La technologie des containers n’a pas été inventée par <code class="docutils literal notranslate"><span class="pre">Docker</span></code>.</p>
<p>Mais celui-ci la considérablement amélioré en y ajoutant de nouveaux concepts et des outils simples à mettre en œuvre.</p>
<p><strong>A l’origine :</strong></p>
<ul class="simple">
<li><p>LXC : <code class="docutils literal notranslate"><span class="pre">Linux</span> <span class="pre">Containers</span></code></p></li>
<li><p>Les <code class="docutils literal notranslate"><span class="pre">NameSpaces</span></code> qui permettent d’isoler les ressources et déterminent ce que peut voir un processus . On peut ainsi isoler</p>
<ul>
<li><p>les ressouces réseaux,</p></li>
<li><p>le système de fichiers,</p></li>
<li><p>les privilèges utilisateurs</p></li>
<li><p>…</p></li>
</ul>
</li>
<li><p>Les <code class="docutils literal notranslate"><span class="pre">CGroups</span></code> qui permettent de limiter l’utilisation des ressources par le container :</p>
<ul>
<li><p>Processeur,</p></li>
<li><p>Mémoire,</p></li>
<li><p>Trafic réseau …</p></li>
</ul>
</li>
</ul>
<p><strong>Les ajouts de Docker:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Docker-Cli</span></code> : Une interface en ligne de commande</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Docker</span> <span class="pre">Engine</span></code>: pour faire tourner les containers comme des processus</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Docker-Hub</span></code> : Un dépot (repository) d’Images de containers prédéfinies</p></li>
<li><p>La gestion des données persistantes dans des volumes</p></li>
<li><p>La gestion d’un réseau virtuel pour les containers</p></li>
</ul>
</section>
<section id="architecture-docker">
<h2>2.3 Architecture Docker<a class="headerlink" href="#architecture-docker" title="Lien permanent vers cette rubrique"></a></h2>
<ul class="simple">
<li><p>Docker utilise une architecture client-serveur.</p></li>
<li><p>Le client Docker communique avec le démon Docker , qui effectue le gros du travail de création, d’exécution et de distribution de vos conteneurs Docker.</p></li>
<li><p>Le client et le démon Docker peuvent s’exécuter sur le même système, ou vous pouvez connecter un client Docker à un démon Docker distant.</p></li>
<li><p>Le client et le démon Docker communiquent à l’aide d’une API REST, via des sockets UNIX ou une interface réseau.</p></li>
<li><p>Un autre client Docker est Docker Compose, qui vous permet de travailler avec des applications composées d’un ensemble de conteneurs.</p></li>
</ul>
<p><img alt="Architecture" src="_images/architecture.svg" /></p>
<section id="container">
<h3>2.3.1 Container<a class="headerlink" href="#container" title="Lien permanent vers cette rubrique"></a></h3>
<ul class="simple">
<li><p>Processus qui va héberger nos applications et nos services.</p></li>
<li><p>Un <strong>conteneur</strong> est une instance exécutable d’une <strong>image</strong> de référence. Vous pouvez</p>
<ul>
<li><p>créer,</p></li>
<li><p>démarrer,</p></li>
<li><p>arrêter,</p></li>
<li><p>déplacer ou</p></li>
<li><p>supprimer un conteneur à l’aide de l’API ou de la CLI Docker.</p></li>
</ul>
</li>
<li><p>Vous pouvez</p>
<ul>
<li><p>connecter un <strong>conteneur</strong> à un ou plusieurs réseaux,</p></li>
<li><p>y attacher un stockage,</p></li>
<li><p>ou même créer une nouvelle image en fonction de son état actuel.</p></li>
</ul>
</li>
<li><p>Par défaut, un <strong>conteneur</strong> est relativement bien isolé des autres conteneurs et de sa machine hôte.</p></li>
<li><p>Vous pouvez contrôler son degré d’isolement par rapport aux autres conteneurs ou à la machine hôte</p>
<ul>
<li><p>réseau,</p></li>
<li><p>stockage,</p></li>
<li><p>…</p></li>
</ul>
</li>
</ul>
<p>Un conteneur est défini par son image ainsi que par les options de configuration que vous lui fournissez lorsque vous le créez ou le démarrez. Lorsqu’un conteneur est supprimé, toutes les modifications apportées à son état qui ne sont pas stockées dans le stockage persistant disparaissent.</p>
</section>
<section id="image">
<h3>2.3.2 Image<a class="headerlink" href="#image" title="Lien permanent vers cette rubrique"></a></h3>
<ul class="simple">
<li><p>Une <strong>image</strong> est un modèle en lecture seule contenant des instructions pour créer un conteneur <code class="docutils literal notranslate"><span class="pre">Docker</span></code>.</p></li>
<li><p>Souvent, une <strong>image</strong> est basée sur une <strong>autre image</strong>, avec quelques personnalisations supplémentaires.</p></li>
</ul>
<p>Par exemple, vous pouvez créer une <strong>image</strong> basée sur l’image <code class="docutils literal notranslate"><span class="pre">debian</span></code>, mais qui installe le serveur Web <code class="docutils literal notranslate"><span class="pre">Apache</span></code> et votre application, ainsi que les détails de configuration nécessaires pour faire fonctionner votre application.</p>
</section>
<section id="volume">
<h3>2.3.3 Volume<a class="headerlink" href="#volume" title="Lien permanent vers cette rubrique"></a></h3>
<p>Dossier local sur la machine hôte qui va permettre de conserver les données après l’arrêt ou la destruction du container.</p>
<p>Les données manipulées dans un container ne sont pas persistantes si elles ne sont pas stockées dans un volume de données.</p>
<p><img alt="donnees" src="_images/donnees.png" /></p>
</section>
<section id="docker-daemon-docker-engine">
<h3>2.3.4 Docker Daemon (Docker Engine)<a class="headerlink" href="#docker-daemon-docker-engine" title="Lien permanent vers cette rubrique"></a></h3>
<ul class="simple">
<li><p>Le démon Docker ( dockerd)</p>
<ul>
<li><p>écoute les requêtes de l’API Docker</p></li>
<li><p>gère les objets Docker tels que</p>
<ul>
<li><p>les images,</p></li>
<li><p>les conteneurs,</p></li>
<li><p>les réseaux et</p></li>
<li><p>les volumes.</p></li>
</ul>
</li>
</ul>
</li>
<li><p>Un démon peut également communiquer avec d’autres démons pour gérer les services Docker.</p></li>
</ul>
</section>
<section id="docker-client-docker-engine">
<h3>2.3.5 Docker Client (Docker Engine)<a class="headerlink" href="#docker-client-docker-engine" title="Lien permanent vers cette rubrique"></a></h3>
<ul class="simple">
<li><p>Le client Docker ( docker) est le principal moyen utilisé par de nombreux utilisateurs Docker pour interagir avec Docker.</p></li>
<li><p>Lorsque vous utilisez des commandes telles que <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">run</span></code>, le client envoie ces commandes à dockerd, qui les exécute.</p></li>
</ul>
</section>
<section id="dockerfile">
<h3>2.3.6 Dockerfile<a class="headerlink" href="#dockerfile" title="Lien permanent vers cette rubrique"></a></h3>
<ul class="simple">
<li><p>Nom du fichier qui va permettre de créer une <strong>image</strong>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Dockerfile</span></code> contient la description de tout ce que doit contenir l”<strong>image</strong> et donc par extension le <strong>container</strong>.</p></li>
</ul>
</section>
<section id="docker-compose">
<h3>2.3.7 Docker Compose<a class="headerlink" href="#docker-compose" title="Lien permanent vers cette rubrique"></a></h3>
<p>Une application qui va permettre de lancer plusieurs containers avec une seule commande, permettant ainsi de créer une stack (pile) de containers travaillant ensemble.</p>
</section>
<section id="docker-desktop-pas-utilise-a-l-iut">
<h3>2.3.8 Docker Desktop (pas utilisé à l’IUT)<a class="headerlink" href="#docker-desktop-pas-utilise-a-l-iut" title="Lien permanent vers cette rubrique"></a></h3>
<ul class="simple">
<li><p>L’application de gestion à installer pour démarrer <code class="docutils literal notranslate"><span class="pre">Docker</span></code> et gérer les <strong>containers</strong>, les <strong>images</strong>, les <strong>volumes</strong> et tous les éléments associés</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Docker</span> <span class="pre">Desktop</span></code> inclut le daemon Docker ( <code class="docutils literal notranslate"><span class="pre">dockerd</span></code>), le client Docker ( <code class="docutils literal notranslate"><span class="pre">docker</span></code>), <code class="docutils literal notranslate"><span class="pre">Docker</span> <span class="pre">Compose</span></code>, Docker Content Trust, Kubernetes et Credential Helper.</p></li>
</ul>
</section>
<section id="docker-registries">
<h3>2.3.9 Docker Registries<a class="headerlink" href="#docker-registries" title="Lien permanent vers cette rubrique"></a></h3>
<ul class="simple">
<li><p>Un registre Docker stocke les images Docker.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Docker</span> <span class="pre">Hub</span></code> est un registre public que tout le monde peut utiliser.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Docker</span></code> est configuré pour rechercher des images sur <code class="docutils literal notranslate"><span class="pre">Docker</span> <span class="pre">Hub</span></code> par défaut. Vous pouvez même exécuter votre propre registre privé.</p></li>
<li><p>Lorsque vous utilisez les commandes <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">pull</span></code> ou <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">run</span></code>, les images requises sont extraites de votre registre configuré.</p></li>
<li><p>Lorsque vous utilisez la <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">push</span></code> commande, votre image est poussée vers votre registre configuré.</p></li>
</ul>
</section>
</section>
<section id="id1">
<h2>2.4 Containers<a class="headerlink" href="#id1" title="Lien permanent vers cette rubrique"></a></h2>
<section id="exemple-de-commande-docker-run">
<h3>2.4.1 Exemple de commande <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">run</span></code><a class="headerlink" href="#exemple-de-commande-docker-run" title="Lien permanent vers cette rubrique"></a></h3>
<p>La commande suivante</p>
<ul class="simple">
<li><p>exécute un <strong>conteneur</strong> <code class="docutils literal notranslate"><span class="pre">debian</span></code>,</p></li>
<li><p>se connecte de manière interactive à votre session de ligne de commande locale</p></li>
<li><p>exécute <code class="docutils literal notranslate"><span class="pre">/bin/bash</span></code>.</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">root@debian10:/home/etudiant# </span>docker run -i -t debian /bin/bash
<span class="go">Unable to find image &#39;debian:latest&#39; locally</span>
<span class="go">latest: Pulling from library/debian</span>
<span class="go">f606d8928ed3: Pull complete </span>
<span class="go">Digest: sha256:e538a2f0566efc44db21503277c7312a142f4d0dedc5d2886932b92626104bff</span>
<span class="go">Status: Downloaded newer image for debian:latest</span>
<span class="gp">root@2f36cc40ce93:/# </span>
</pre></div>
</div>
<p>Remarque (en supposant que vous utilisez la configuration de registre par défaut) :</p>
<ol class="arabic simple">
<li><p>Si vous n’avez pas l’image <code class="docutils literal notranslate"><span class="pre">debian</span></code> localement, <code class="docutils literal notranslate"><span class="pre">Docker</span></code> l’extrait de votre registre configuré, comme si vous aviez exécuté <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">pull</span> <span class="pre">debian</span></code> manuellement.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Docker</span></code> crée un nouveau <strong>conteneur</strong>, comme si vous aviez exécuté un <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">container</span> <span class="pre">create</span></code> commande manuellement.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Docker</span></code> alloue au <strong>conteneur</strong> un système de fichiers en lecture-écriture. Cela permet à un <strong>conteneur</strong> en cours d’exécution de créer ou de modifier des fichiers et répertoires dans son système de fichiers local.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Docker</span></code> crée une interface réseau avec une adresse IP au conteneur. Par défaut, les <strong>conteneurs</strong> peuvent connecter à des réseaux externes à l’aide de la connexion réseau de la machine hôte.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Docker</span></code> démarre le <strong>conteneur</strong> et exécute <code class="docutils literal notranslate"><span class="pre">/bin/bash</span></code>. Le conteneur s’exécute de manière interactive et est attaché à votre terminal (<code class="docutils literal notranslate"><span class="pre">-i</span></code> et <code class="docutils literal notranslate"><span class="pre">-t</span></code>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">exit</span></code> termine la commande <code class="docutils literal notranslate"><span class="pre">/bin/bash</span></code>, le <strong>conteneur</strong> s’arrête mais n’est pas supprimé. Vous pouvez le redémarrer ou le supprimer.</p></li>
</ol>
</section>
<section id="quelques-commandes-pour-les-conteneurs">
<h3>2.4.2 Quelques commandes pour les conteneurs<a class="headerlink" href="#quelques-commandes-pour-les-conteneurs" title="Lien permanent vers cette rubrique"></a></h3>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="text-left head"><p>COMMANDE</p></th>
<th class="text-left head"><p>USAGE</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">run</span> <span class="pre">&lt;image&gt;</span></code></p></td>
<td class="text-left"><p>crée et lance un container à partir de l’image spécifiée</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">ps</span></code></p></td>
<td class="text-left"><p>liste des containers en cours d’exécution -a pour voir tous les containers</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">exec</span> <span class="pre">&lt;container&gt;</span></code></p></td>
<td class="text-left"><p>lance une commande dans un container</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">stop</span> <span class="pre">&lt;container&gt;</span></code></p></td>
<td class="text-left"><p>arrête un container</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">start</span> <span class="pre">&lt;container&gt;</span></code></p></td>
<td class="text-left"><p>redémarre un container existant</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">rm</span> <span class="pre">&lt;container&gt;</span></code></p></td>
<td class="text-left"><p>supprime un container</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">commit</span> <span class="pre">&lt;container&gt;</span></code></p></td>
<td class="text-left"><p>crée une nouvelle image à partir d’un container</p></td>
</tr>
</tbody>
</table>
</section>
<section id="docker-run-en-detail">
<h3>2.4.3 <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">run</span></code> en détail<a class="headerlink" href="#docker-run-en-detail" title="Lien permanent vers cette rubrique"></a></h3>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="text-left head"><p>OPTIONS</p></th>
<th class="text-left head"><p>USAGE</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">--name</span> <span class="pre">NOM</span></code></p></td>
<td class="text-left"><p>permet de nommer le container</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">-d</span></code></p></td>
<td class="text-left"><p>lance le container en arrière plan</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">-ti</span></code></p></td>
<td class="text-left"><p>lance le container avec un terminal interactif. Pour lancer un shell par exemple</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">-p</span> <span class="pre">Port_Local:Port_Container</span></code></p></td>
<td class="text-left"><p>permet de rediriger un port du container vers un port local (localhost)</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">-v</span> <span class="pre">Chemin_local:Chemin_container</span></code></p></td>
<td class="text-left"><p>permet de faire persister les données du container dans un dossier local</p></td>
</tr>
</tbody>
</table>
</section>
<section id="container-deux-grands-principes-a-comprendre">
<h3>Container: deux grands principes à comprendre<a class="headerlink" href="#container-deux-grands-principes-a-comprendre" title="Lien permanent vers cette rubrique"></a></h3>
<ul class="simple">
<li><p>Un container ne reste actif que si un processus (un service) est actif dans celui-ci.</p></li>
<li><p>Les modifications faites dans un container sont perdues à l’arrêt de celui-ci, sauf si on utilise des volumes. (Option - v)</p></li>
</ul>
</section>
</section>
<section id="persistance-des-donnees">
<h2>Persistance des données<a class="headerlink" href="#persistance-des-donnees" title="Lien permanent vers cette rubrique"></a></h2>
<section id="commit-docker-commit-container-image">
<h3>Commit : <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">commit</span> <span class="pre">&lt;Container&gt;</span> <span class="pre">&lt;Image&gt;</span></code><a class="headerlink" href="#commit-docker-commit-container-image" title="Lien permanent vers cette rubrique"></a></h3>
<p>Un des moyens de conserver les données et modification faites dans un formulaire est de recréer une nouvelle image à partir de celui-ci.</p>
<p>Si cette méthode est effectivement la plus simple à mettre en oeuvre, il faut quand même prendre en compte ces considérations :</p>
<p><strong>AVANTAGES :</strong></p>
<ul class="simple">
<li><p>Le rédéploiement du container sur une autre machine est très simple et rapide puisque l’image contient toutes les modifications, y compris les données utilisateurs qui auraient pu être saisies ou modifiées.</p></li>
<li><p>Si on à ajouter des services ou des librairies dans le container, c’est la meilleure méthode à adopter.</p></li>
</ul>
<p><strong>INCONVENIENTS:</strong></p>
<ul class="simple">
<li><p>Si la méthode est effectivement bien adaptée à l’ajout de services ou de librairies, elle ne l’est pas pour les données. En Effet chaque commit va enregistrer les différences entre l’image initiale et le container et créer une nouvelle couche dans la nouvelle image. Conséquence des images de plus en plus grosse, donc plus longue à copier et à redéployer.</p></li>
</ul>
</section>
<section id="volumes">
<h3>Volumes<a class="headerlink" href="#volumes" title="Lien permanent vers cette rubrique"></a></h3>
<p>Un volume <code class="docutils literal notranslate"><span class="pre">Docker</span></code> est un emplacement (un dossier) créé sur la machine hôte qui est partagé avec le container. En terme Lunixien, on parle de « monter » le volume dans le container.</p>
<p>ajouter des lignes dans le corp</p>
<p>Il existe deux façons de créer les volumes :</p>
<ol class="arabic simple">
<li><p>Utiliser la commande <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">volume</span></code></p></li>
<li><p>Utiliser l’option <code class="docutils literal notranslate"><span class="pre">-v</span></code> qui créer le volume en même temps que le container <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">run</span> <span class="pre">-v</span> <span class="pre">local:distant</span> <span class="pre">&lt;image&gt;</span></code></p></li>
</ol>
<ul class="simple">
<li><p>local désigne alors le dossier local sur votre machine</p></li>
<li><p>distant désigne le dossier que vous voulez associé sur le container</p></li>
</ul>
<p>Exemple <code class="docutils literal notranslate"><span class="pre">-v</span> <span class="pre">/home/etudiant/www:/var/www</span></code></p>
<ul class="simple">
<li><p>Toutes les données écrites dans <code class="docutils literal notranslate"><span class="pre">/home/etudiant/www</span></code> seront visibles sur le container dans <code class="docutils literal notranslate"><span class="pre">/var/www</span></code>.</p></li>
<li><p>A la suppression du container, les données dans <code class="docutils literal notranslate"><span class="pre">/home/etudiant/www</span></code> seront conservées et donc réutilisables si lorsque l’on relancera le container avec la même option.</p></li>
</ul>
<p>A noter que l’on peut aussi simplement nommé un volume local sans préciser de chemin. Celui-ci sera alors créé dans le dossier <code class="docutils literal notranslate"><span class="pre">/var/lib/docker/overlay/</span></code> de votre machine et restera aussi accessible même après la destruction du container.</p>
</section>
</section>
<section id="images">
<h2>Images<a class="headerlink" href="#images" title="Lien permanent vers cette rubrique"></a></h2>
</section>
<section id="docker-et-la-gestion-du-reseau">
<h2>Docker et la gestion du réseau<a class="headerlink" href="#docker-et-la-gestion-du-reseau" title="Lien permanent vers cette rubrique"></a></h2>
<p><img alt="reseau" src="_images/reseau.PNG" /></p>
<p>Connecter des containers à un réseau virtuel associé à un driver :</p>
<ul class="simple">
<li><p>none : isolation des containers sans possibilité de communication avec l’extérieur</p></li>
<li><p>bridge : interface docker0, driver par défaut, communication entre container mais pas accessible depuis l’extérieur
host : les containers ont la même adresse IP que la machine hôte (pas d’isolation réseau)</p></li>
<li><p>overlay : mise en réseau de plusieurs machines hôtes utilisant docker</p></li>
<li><p>macvlan : gestion des vlans et addresses physiques par container</p></li>
</ul>
<section id="mode-bridge">
<h3>Mode Bridge<a class="headerlink" href="#mode-bridge" title="Lien permanent vers cette rubrique"></a></h3>
<p><img alt="reseau" src="_images/reseauBridge.PNG" /></p>
<p>Création d’un réseau nommé net1Bridge</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">root@debian10:~# </span>docker network create --driver bridge --subnet<span class="o">=</span><span class="m">192</span>.168.1.0/24 --gateway<span class="o">=</span><span class="m">192</span>.168.1.1 net1Bridge
<span class="go">2ccd2d38b4c673e0d3f4aeaa20ff0d4b138e8e4dfb8488486d1acd91ff6021aa</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">root@debian10:~# </span>docker network ls
<span class="go">NETWORK ID     NAME         DRIVER    SCOPE</span>
<span class="go">95f450cbb8d5   bridge       bridge    local</span>
<span class="go">f04eb74b2fff   host         host      local</span>
<span class="go">2ccd2d38b4c6   net1Bridge   bridge    local</span>
<span class="go">244ff986ac02   none         null      local</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">root@debian10:~# </span>docker network inspect net1Bridge
<span class="go">[</span>
<span class="go">    {</span>
<span class="go">        &quot;Name&quot;: &quot;net1Bridge&quot;,</span>
<span class="go">        &quot;Id&quot;: &quot;2ccd2d38b4c673e0d3f4aeaa20ff0d4b138e8e4dfb8488486d1acd91ff6021aa&quot;,</span>
<span class="go">        &quot;Created&quot;: &quot;2022-10-19T17:04:32.426718664+02:00&quot;,</span>
<span class="go">        &quot;Scope&quot;: &quot;local&quot;,</span>
<span class="go">        &quot;Driver&quot;: &quot;bridge&quot;,</span>
<span class="go">        &quot;EnableIPv6&quot;: false,</span>
<span class="go">        &quot;IPAM&quot;: {</span>
<span class="go">            &quot;Driver&quot;: &quot;default&quot;,</span>
<span class="go">            &quot;Options&quot;: {},</span>
<span class="go">            &quot;Config&quot;: [</span>
<span class="go">                {</span>
<span class="go">                    &quot;Subnet&quot;: &quot;192.168.1.0/24&quot;,</span>
<span class="go">                    &quot;Gateway&quot;: &quot;192.168.1.1&quot;</span>
<span class="go">                }</span>
<span class="go">            ]</span>
<span class="go">        },</span>
<span class="go">        &quot;Internal&quot;: false,</span>
<span class="go">        &quot;Attachable&quot;: false,</span>
<span class="go">        &quot;Ingress&quot;: false,</span>
<span class="go">        &quot;ConfigFrom&quot;: {</span>
<span class="go">            &quot;Network&quot;: &quot;&quot;</span>
<span class="go">        },</span>
<span class="go">        &quot;ConfigOnly&quot;: false,</span>
<span class="go">        &quot;Containers&quot;: {},</span>
<span class="go">        &quot;Options&quot;: {},</span>
<span class="go">        &quot;Labels&quot;: {}</span>
<span class="go">    }</span>
<span class="go">]</span>
</pre></div>
</div>
<p>Création de deux containers <strong>debG</strong> et <strong>debD</strong> à partir d’une image <strong>debian</strong> associé au réseau <strong>net1Bridge</strong></p>
<ul class="simple">
<li><p>-d Run container in background and print container ID</p></li>
<li><p>-i Keep STDIN open even if not attached</p></li>
<li><p>-t Allocate a pseudo-TTY</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">root@debian10:~# </span>docker run -dit --name debG --network net1Bridge debian
<span class="go">4bec91791c34be56041ab378ef62391653e1c098d53776e054d793ac13247718</span>

<span class="gp">root@debian10:~# </span>docker run -dit --name debD --network net1Bridge debian
<span class="go">f32f5cd55b0a68fa8f88b2f4aa3a2c10b724dad11b3a151b2c49a109bbfb29cc</span>
</pre></div>
</div>
<p>On vérifie le lancement des containers</p>
<p><code class="docutils literal notranslate"><span class="pre">root&#64;debian10:~#</span> <span class="pre">docker</span> <span class="pre">container</span> <span class="pre">ls</span></code></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">CONTAINER ID   IMAGE     COMMAND   CREATED          STATUS          PORTS     NAMES</span>
<span class="go">f32f5cd55b0a   debian    &quot;bash&quot;    14 minutes ago   Up 14 minutes             debD</span>
<span class="go">4bec91791c34   debian    &quot;bash&quot;    32 minutes ago   Up 32 minutes             debG</span>
</pre></div>
</div>
<p>On vérifie les &#64;IP associées aux containers</p>
<p><code class="docutils literal notranslate"><span class="pre">root&#64;debian10:~#</span> <span class="pre">docker</span> <span class="pre">network</span> <span class="pre">inspect</span> <span class="pre">net1Bridge</span></code></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">[</span>
<span class="go">    {</span>
<span class="go">        &quot;Name&quot;: &quot;net1Bridge&quot;,</span>
<span class="go">        &quot;Id&quot;: &quot;2ccd2d38b4c673e0d3f4aeaa20ff0d4b138e8e4dfb8488486d1acd91ff6021aa&quot;,</span>
<span class="go">        &quot;Created&quot;: &quot;2022-10-19T17:04:32.426718664+02:00&quot;,</span>
<span class="go">        &quot;Scope&quot;: &quot;local&quot;,</span>
<span class="go">        &quot;Driver&quot;: &quot;bridge&quot;,</span>
<span class="go">        &quot;EnableIPv6&quot;: false,</span>
<span class="go">        &quot;IPAM&quot;: {</span>
<span class="go">            &quot;Driver&quot;: &quot;default&quot;,</span>
<span class="go">            &quot;Options&quot;: {},</span>
<span class="go">            &quot;Config&quot;: [</span>
<span class="go">                {</span>
<span class="go">                    &quot;Subnet&quot;: &quot;192.168.1.0/24&quot;,</span>
<span class="go">                    &quot;Gateway&quot;: &quot;192.168.1.1&quot;</span>
<span class="go">                }</span>
<span class="go">            ]</span>
<span class="go">        },</span>
<span class="go">        &quot;Internal&quot;: false,</span>
<span class="go">        &quot;Attachable&quot;: false,</span>
<span class="go">        &quot;Ingress&quot;: false,</span>
<span class="go">        &quot;ConfigFrom&quot;: {</span>
<span class="go">            &quot;Network&quot;: &quot;&quot;</span>
<span class="go">        },</span>
<span class="go">        &quot;ConfigOnly&quot;: false,</span>
<span class="go">        &quot;Containers&quot;: {</span>
<span class="go">            &quot;4bec91791c34be56041ab378ef62391653e1c098d53776e054d793ac13247718&quot;: {</span>
<span class="go">                &quot;Name&quot;: &quot;debG&quot;,</span>
<span class="go">                &quot;EndpointID&quot;: &quot;d128e36f1fd5c334e0c6bb7ed6f47e256a728d0e9789d8b33841701109c89a01&quot;,</span>
<span class="go">                &quot;MacAddress&quot;: &quot;02:42:c0:a8:01:02&quot;,</span>
<span class="go">                &quot;IPv4Address&quot;: &quot;192.168.1.2/24&quot;,</span>
<span class="go">                &quot;IPv6Address&quot;: &quot;&quot;</span>
<span class="go">            },</span>
<span class="go">            &quot;f32f5cd55b0a68fa8f88b2f4aa3a2c10b724dad11b3a151b2c49a109bbfb29cc&quot;: {</span>
<span class="go">                &quot;Name&quot;: &quot;debD&quot;,</span>
<span class="go">                &quot;EndpointID&quot;: &quot;22f833a9100e2438562a5b15a1045e9981c282ecb25447cad431915b6c59c12e&quot;,</span>
<span class="go">                &quot;MacAddress&quot;: &quot;02:42:c0:a8:01:03&quot;,</span>
<span class="go">                &quot;IPv4Address&quot;: &quot;192.168.1.3/24&quot;,</span>
<span class="go">                &quot;IPv6Address&quot;: &quot;&quot;</span>
<span class="go">            }</span>
<span class="go">        },</span>
<span class="go">        &quot;Options&quot;: {},</span>
<span class="go">        &quot;Labels&quot;: {}</span>
<span class="go">    }</span>
<span class="go">]</span>
</pre></div>
</div>
<p>Lancement avec <code class="docutils literal notranslate"><span class="pre">exec</span></code> de commande dans les containers</p>
<p><code class="docutils literal notranslate"><span class="pre">root&#64;debian10:~#</span> <span class="pre">docker</span> <span class="pre">exec</span> <span class="pre">debG</span> <span class="pre">ip</span> <span class="pre">addr</span></code></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span>
<span class="go">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span>
<span class="go">    inet 127.0.0.1/8 scope host lo</span>
<span class="go">       valid_lft forever preferred_lft forever</span>
<span class="go">9: eth0@if10: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default </span>
<span class="go">    link/ether 02:42:c0:a8:01:02 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span>
<span class="go">    inet 192.168.1.2/24 brd 192.168.1.255 scope global eth0</span>
<span class="go">       valid_lft forever preferred_lft forever</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">root&#64;debian10:~#</span> <span class="pre">docker</span> <span class="pre">exec</span> <span class="pre">-it</span> <span class="pre">debD</span> <span class="pre">ping</span> <span class="pre">-c1</span> <span class="pre">192.168.1.2</span></code></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">PING 192.168.1.2 (192.168.1.2) 56(84) bytes of data.</span>
<span class="go">64 bytes from 192.168.1.2: icmp_seq=1 ttl=64 time=0.075 ms</span>

<span class="go">--- 192.168.1.2 ping statistics ---</span>
<span class="go">1 packets transmitted, 1 received, 0% packet loss, time 0ms</span>
<span class="go">rtt min/avg/max/mdev = 0.075/0.075/0.075/0.000 ms</span>
</pre></div>
</div>
<p>Remarque : il a fallu installer ping et ip dans les containers (pas présent sur capture)</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">docker exec -it debD apt-get update</span>
<span class="go">docker exec -it debD apt-get install iputils-ping</span>
<span class="go">docker exec -it debG apt-get update</span>
<span class="go">docker exec -it debG apt-get install iroute2</span>
</pre></div>
</div>
<p>Un aide-mémoire pour Docker
Introduction</p>
<p>Docker vous permet d’empaqueter facilement vos applications et services dans des conteneurs afin de pouvoir les utiliser partout. Cependant, lorsque vous travaillez avec Docker, il est également facile d’accumuler un nombre excessif d’images, de conteneurs et de volumes de données inutilisés qui alourdissent la sortie et consomment de l’espace disque.</p>
<p>Docker vous donne tous les outils dont vous avez besoin pour nettoyer votre système de la ligne de commande. Ce guide de type aide-mémoire fournit une référence rapide aux commandes qui sont utiles pour libérer de l’espace disque et garder votre système organisé en supprimant les images, conteneurs et volumes inutilisés de Docker.</p>
<p>Comment utiliser ce guide :</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Ce guide est au format aide-mémoire avec des extraits de lignes de commande autonomes
Sautez à la section qui correspond à la tâche que vous essayez d’accomplir.
</pre></div>
</div>
<p>La syntaxe de substitution des commandes, commandant $( command), utilisée dans les commandes est disponible dans de nombreux shell populaires tels que bash, zsh et Windows Powershell.
Élimination de toutes les images, conteneurs, volumes et réseaux inutilisés ou en suspens</p>
<p>Docker fournit une commande unique qui nettoiera toutes les ressources - images, conteneurs, volumes et réseaux - qui sont en suspens (non associées à un conteneur) :</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>docker system prune
</pre></div>
</div>
<p>Pour supprimer en plus tous les conteneurs arrêtés et toutes les images non utilisées (pas seulement les images en suspens), ajoutez l’indicateur -a à la commande :</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>docker system prune -a
</pre></div>
</div>
<p>Suppression des images de Docker
Supprimer une ou plusieurs images spécifiques</p>
<p>Utilisez la commande docker images avec le drapeau -a pour localiser l’ID des images que vous voulez supprimer. Cela vous montrera toutes les images, y compris les couches d’images intermédiaires. Lorsque vous avez localisé les images que vous voulez supprimer, vous pouvez passer leur ID ou leur étiquette à docker rmi :</p>
<p>Lister :</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>docker images -a
</pre></div>
</div>
<p>Supprimer :</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>docker rmi Image Image
</pre></div>
</div>
<p>Supprimer les images en suspens</p>
<p>Les images de Docker sont constituées de plusieurs couches. Les images en suspens sont des couches qui n’ont aucune relation avec les images marquées. Elles n’ont plus d’utilité et consomment de l’espace disque. Elles peuvent être localisées en ajoutant le drapeau filtre, -f avec une valeur de dangling=true à la commande docker images. Lorsque vous êtes sûr de vouloir les supprimer, vous pouvez utiliser la commande docker images purge :</p>
<p>Remarque : Si vous construisez une image sans la tagger, l’image apparaîtra dans la liste des images en suspens car elle n’a pas d’association avec une image taguée. Vous pouvez éviter cette situation en fournissant une balise lors de la construction, et vous pouvez tagger rétroactivement une image avec la commande docker tag.’</p>
<p>Lister :</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>docker images -f dangling=true
</pre></div>
</div>
<p>Supprimer :</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>docker images purge
</pre></div>
</div>
<p>Suppression d’images selon un modèle</p>
<p>Vous pouvez trouver toutes les images qui correspondent à un modèle en utilisant une combinaison de docker images et grep. Une fois que vous êtes satisfait, vous pouvez les supprimer en utilisant awk pour passer les identifiants à docker rmi. Notez que ces utilitaires ne sont pas fournis par Docker et ne sont pas nécessairement disponibles sur tous les systèmes :</p>
<p>Lister :</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>docker images -a |  grep &quot;pattern&quot;
</pre></div>
</div>
<p>Supprimer :</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>docker images -a | grep &quot;pattern&quot; | awk &#39;{print $3}&#39; | xargs docker rmi
</pre></div>
</div>
<p>Supprimer toutes les images</p>
<p>Toutes les images de Docker sur un système peuvent être listées en ajoutant -a à la commande docker images. Une fois que vous êtes sûr de vouloir toutes les supprimer, vous pouvez ajouter le drapeau -q pour passer l’ID de l’image au docker rmi :</p>
<p>Lister :</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>docker images -a
</pre></div>
</div>
<p>Supprimer :</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>docker rmi $(docker images -a -q)
</pre></div>
</div>
<p>Suppression de conteneurs
Supprimer un ou plusieurs conteneurs spécifiques</p>
<p>Utilisez la commande docker ps avec le drapeau -a pour localiser le nom ou l’ID des conteneurs que vous voulez supprimer.</p>
<p>Lister :</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>docker ps -a
</pre></div>
</div>
<p>Supprimer :</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>docker rm ID_or_Name ID_or_Name
</pre></div>
</div>
<p>Supprimer un conteneur à la sortie</p>
<p>Si vous savez, lorsque vous créez un conteneur, que vous ne voudrez pas le conserver une fois que vous aurez terminé, vous pouvez lancer le programme docker run –rm pour le supprimer automatiquement à sa sortie.</p>
<p>Exécuter et supprimer :</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>docker run --rm image_name
</pre></div>
</div>
<p>Supprimer tous les conteneurs quittés</p>
<p>Vous pouvez localiser les conteneurs en utilisant le docker ps -a et les filtrer selon leur statut : créé, redémarré, en cours d’exécution, en pause ou quitté. Pour consulter la liste des conteneurs quittés, utilisez le drapeau -f pour filtrer en fonction de leur statut. Lorsque vous avez vérifié que vous voulez supprimer ces conteneurs, utilisez -q pour transmettre les ID à la commande docker rm.</p>
<p>Lister :</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>docker ps -a -f status=exited
</pre></div>
</div>
<p>Supprimer :</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>docker rm $(docker ps -a -f status=exited -q)
</pre></div>
</div>
<p>Supprimer les conteneurs en utilisant plusieurs filtre</p>
<p>Les filtres de Docker peuvent être combinés en répétant le drapeau filter avec une valeur supplémentaire. Il en résulte une liste de conteneurs qui remplissent l’une ou l’autre de ces conditions. Par exemple, si vous voulez supprimer tous les conteneurs marqués comme étant soit Créé (un état qui peut survenir lorsque vous exécutez un conteneur avec une commande non valide) soit Quitté, vous pouvez utiliser deux filtres :</p>
<p>Lister :</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>docker ps -a -f status=exited -f status=created
</pre></div>
</div>
<p>Supprimer :</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>docker rm $(docker ps -a -f status=exited -f status=created -q)
</pre></div>
</div>
<p>Supprimer des conteneurs selon un modèle</p>
<p>Vous pouvez trouver tous les containers qui correspondent à un modèle en utilisant une combinaison de docker ps et grep. Lorsque vous êtes satisfait de la liste que vous souhaitez supprimer, vous pouvez utiliser awk et xargs pour fournir l’ID à docker rmi. Notez que ces utilitaires ne sont pas fournis par Docker et ne sont pas nécessairement disponibles sur tous les systèmes :</p>
<p>Lister :</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>docker ps -a |  grep &quot;pattern”
</pre></div>
</div>
<p>Supprimer :</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>docker ps -a | grep &quot;pattern&quot; | awk &#39;{print $3}&#39; | xargs docker rmi
</pre></div>
</div>
<p>Arrêter et supprimer tous les conteneurs</p>
<p>Vous pouvez consulter les conteneurs sur votre système avec docker ps. L’ajout du drapeau -a affichera tous les conteneurs. Lorsque vous êtes sûr de vouloir les supprimer, vous pouvez ajouter le drapeau -q pour fournir les identifiants aux commandes docker start et docker rm :</p>
<p>Lister :</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>docker ps -a
</pre></div>
</div>
<p>Supprimer :</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>docker stop $(docker ps -a -q)
docker rm $(docker ps -a -q)
</pre></div>
</div>
<p>Suppression de volumes
Supprimer un ou plusieurs volumes spécifiques - Docker 1.9 et suivants</p>
<p>Utilisez la commande docker volume ls pour localiser le ou les noms de volume que vous souhaitez supprimer. Ensuite, vous pouvez supprimer un ou plusieurs volumes avec la commande docker volume rm :</p>
<p>Lister :</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>docker volume ls
</pre></div>
</div>
<p>Supprimer :</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>docker volume rm volume_name volume_name
</pre></div>
</div>
<p>Supprimer des volumes en suspens - Docker 1.9 et suivants</p>
<p>Étant donné que le principe des volumes est d’exister indépendamment des conteneurs, lorsqu’un conteneur est retiré, un volume n’est pas automatiquement retiré en même temps. Lorsqu’un volume existe et n’est plus connecté à aucun conteneur, on l’appelle un volume en suspens. Pour les localiser afin de confirmer que vous voulez les retirer, vous pouvez utiliser la commande docker volume ls avec un filtre pour limiter les résultats aux volumes en suspens. Lorsque vous êtes satisfait de la liste, vous pouvez tous les supprimer avec docker volume prune :</p>
<p>Lister :</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>docker volume ls -f dangling=true
</pre></div>
</div>
<p>Supprimer :</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>docker volume prune
</pre></div>
</div>
<p>Supprimer un conteneur et son volume</p>
<p>Si vous avez créé un volume sans nom, il peut être supprimé en même temps que le conteneur avec le drapeau -v. Notez que cela ne fonctionne qu’avec les volumes non nommés. Lorsque le conteneur est supprimé avec succès, son ID est affiché. Notez qu’aucune référence n’est faite à la suppression du volume. S’il n’est pas nommé, il est supprimé silencieusement du système. S’il est nommé, il reste silencieusement présent.</p>
<p>Supprimer :</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>docker rm -v container_name
</pre></div>
</div>
<p>Conclusion</p>
<p>Ce guide couvre certaines des commandes courantes utilisées pour supprimer les images, les conteneurs et les volumes avec Docker. Il existe de nombreuses autres combinaisons et drapeaux qui peuvent être utilisés avec chacun d’entre eux. Pour un guide complet sur ce qui est disponible, consultez la documentation Docker pour docker system prune, docker rmi, docker rm et docker volume rm. S’il existe des tâches courantes de nettoyage que vous souhaitez voir dans le guide, veuillez demander ou faire des suggestions dans les commentaires.</p>
<hr class="docutils" />
<p><img alt="Creative Commons" src="_images/88x31.png" /></p>
<p><a class="reference external" href="http://creativecommons.org/licenses/by-nc-nd/4.0/">Ce document est mis à disposition selon les termes de la Licence Creative Commons Attribution - Pas d’Utilisation Commerciale - Pas de Modification 4.0 International</a></p>
<p>IUT Lannion © 2022 by R&amp;T is licensed under CC BY-NC-ND 4.0</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Philippe Durand.</p>
  </div>

  Compilé avec <a href="https://www.sphinx-doc.org/">Sphinx</a> en utilisant un
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">thème</a>
    fourni par <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>